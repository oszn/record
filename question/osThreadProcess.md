# 进程、线程、协程

其实进程线程而言，我对线程熟悉程度较高，进程一直是了解一部分，所以为了弥补这一部分存在，今天决定阅读下，进程与协程和线程相关内容，首先兴趣度较高的是协程。

## 协程

我一直对这个概念还是挺模糊的，一直对他的认知是操作系统最小粒度，也就是cpu的分配最小单元是线程，并没有协程这一说法，所以协程更想是人为的一个概念来着。

from [link](https://www.cnblogs.com/liang1101/p/7285955.html)

协程目前在golang比较适用，著名的goroutine,其实我看了一遍文章还是有很多的疑问。

协程的特点是轻量级，为什么轻量级感觉不太懂，线程所需要的空间是MB级别，协程则是kb级别的。

首先提出问题,日后好继续学习

1. 为什么一个协程的是kb级别(他想对比线程共享了哪些东西，优化了哪些内容)
2. 每个线程都有自己的栈空间，那么对于协程来说这些栈空间是怎么分配的，也就是函数的调用链怎么解决的问题。
3. 协程级别内的函数调用的分配是什么，确认下（文中说是栈，如果是栈的话很有可能很多先入栈的代码块没办法获取cpu，所以我猜可能是队列维护）

现在获得几个观点

```
协程（Coroutine）是在1963年由Melvin E. Conway USAF, Bedford, MA等人提出的一个概念。而且协程的概念是早于线程（Thread）提出的。但是由于协程是非抢占式的调度，无法实现公平的任务调用。也无法直接利用多核优势。因此，我们不能武断地说协程是比线程更高级的技术。
　　尽管，在任务调度上，协程是弱于线程的。但是在资源消耗上，协程则是极低的。一个线程的内存在 MB 级别，而协程只需要 KB 级别。而且线程的调度需要内核态与用户的频繁切入切出，资源消耗也不小。
我们把协程的基本特点归纳为：
1. 协程调度机制无法实现公平调度
2. 协程的资源开销是非常低的，一台普通的服务器就可以支持百万协程。
 　　那么，近几年为何协程的概念可以大热。我认为一个特殊的场景使得协程能够广泛的发挥其优势，并且屏蔽掉了劣势 --> 网络编程。与一般的计算机程序相比，网络编程有其独有的特点。
1. 高并发（每秒钟上千数万的单机访问量）
2. Request/Response。程序生命期端（毫秒，秒级）
3. 高IO，低计算（连接数据库，请求API）。
```

从网络上的观点看来，可以确定的是协程必须使用到线程，说白了，协程说到底也只是一个用户态的东西，操作系统并没有原生支持这玩意，所以对于cpu调度来说还得是线程来搞。感觉总的来说，就是有一个队列有一个数据结构，这个结构就是仿线程，储存了代码，栈空间，和当前cpu执行的上下文等，然后一旦遇到了阻塞就会主动让出执行。但存在的问题就明显了，他没有公平的调度可言，线程中cpu时间片到了会强制你让出来执行，但协程中则需要自己去定义这个让出过程。



go中协程调度

[link 上](https://segmentfault.com/a/1190000040710568)

[link 下](https://segmentfault.com/a/1190000040713660?utm_source=sf-similar-article)

大致了解了**问题3**的过程，全局队列和本地队列来维护调度问题，在go的方面来说的。

![img](https://segmentfault.com/img/remote/1460000040710572)

线程本身就是进程的一部分，那我线程共享个队列没啥问题吧。

![G-M-P](https://segmentfault.com/img/remote/1460000040710571)

那假设有4个核心接受4个线程，可以知道M是个执行线程，那就直接指定8个m，那么每个m肯定就和普通线程类似了，但是m需要做的事情就是像p索要执行的g，那么问题就明了。那说到底p和g是什么？程序，也可以看出数据结构吧。但这些事情你感受不到，go帮你底层解决了。我觉得吧这个m应该只是进程内独有的，毕竟线程也就是进程的一部分。这个不可能是全局的。而具体的队列如何执行得看看情况吧，平均执行这玩意，一看就不靠谱，我每个都等是不是很难受了，应该可以做到先到先弄，即使阻塞也得让堵塞得弄完，没得从头排队。



再回到**问题1**，这个问题我觉得得看看golang如何创建过程，可以看出golang得协程是基于func级别的，那可以理解为一个计算任务，当然线程很多也是基于func级别的。那为啥可以小那么多的空间了，没看见谁去说这个问题，线程栈需要2m，而协程栈只需要2k。不懂不懂。

### summary

今天看了2个小时左右关于这个东西，从golang的goroutine的角度学习协程相关内容，可以大致了解到协程非常非常适合互联网的web方式。